<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="utf-8">
    <title>æ™®ç‰©å¯¦é©—å°å·¥å…· - æå®œé–</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="ç‰©ç†å¯¦é©—æ•¸æ“šåˆ†æå·¥å…·" name="description">
    <!--Fav-->
    <link href="images/fish.png" rel="shortcut icon">
    
    <!--styles-->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">
    
    <!--fonts google-->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,500,700' rel='stylesheet' type='text/css'>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
      body {
        background-color: #f5f5f5;
        padding-top: 20px;
      }
      
      .back-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        padding: 10px 20px;
        background-color: #818181;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        font-size: 14px;
        transition: all 0.3s ease;
        z-index: 1000;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
      }
      
      .back-btn:hover {
        background-color: #2f2f2f;
        color: white;
        text-decoration: none;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }
      
      .page-header {
        text-align: center;
        padding: 40px 0 30px;
        background: white;
        margin-bottom: 30px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      
      .page-title {
        font-size: 36px;
        font-weight: 700;
        color: #333;
        margin-bottom: 10px;
        font-family: 'Roboto Slab', serif;
      }
      
      .page-subtitle {
        font-size: 18px;
        color: #666;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
      }
      
      .tool-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
      }
      
      .tool-card {
        background: white;
        border-radius: 8px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      
      .tool-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }
      
      .tab-btn {
        padding: 12px 24px;
        background-color: #e0e0e0;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
      }
      
      .tab-btn:hover {
        background-color: #bdbdbd;
      }
      
      .tab-btn.active {
        background-color: #818181;
        color: white;
      }
      
      .tool-content {
        display: none;
      }
      
      .tool-content.active {
        display: block;
      }
      
      .input-group {
        margin-bottom: 20px;
      }
      
      .input-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
        font-size: 14px;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
      }
      
      .input-group input,
      .input-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
      }
      
      .input-group textarea {
        min-height: 120px;
        resize: vertical;
        font-family: 'Courier New', monospace;
      }
      
      .calculate-btn {
        background-color: #818181;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 5px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
      }
      
      .calculate-btn:hover {
        background-color: #2f2f2f;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }
      
      .result-box {
        margin-top: 30px;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 5px;
        border-left: 4px solid #818181;
      }
      
      .result-box h4 {
        margin-top: 0;
        margin-bottom: 15px;
        color: #333;
        font-size: 18px;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
      }
      
      .result-item {
        margin-bottom: 10px;
        font-size: 14px;
        line-height: 1.6;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
      }
      
      .hint-text {
        font-size: 13px;
        color: #666;
        font-style: italic;
        margin-top: 5px;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
      }
      
      .footer-links {
        text-align: center;
        padding: 30px 0;
        margin-top: 50px;
        border-top: 1px solid #ddd;
      }
      
      .footer-links a {
        color: #818181;
        text-decoration: none;
        margin: 0 15px;
        font-size: 14px;
        transition: color 0.3s ease;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
      }
      
      .footer-links a:hover {
        color: #2f2f2f;
      }
      
      .chart-container {
        position: relative;
        height: 400px;
        margin-top: 20px;
        padding: 15px;
        background-color: white;
        border-radius: 5px;
        border: 1px solid #ddd;
      }
      
      .chart-controls {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-top: 15px;
        padding: 15px;
        background-color: #f9f9f9;
        border-radius: 5px;
      }
      
      .chart-controls .input-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 150px;
      }
      
      .control-section {
        width: 100%;
        margin-top: 10px;
        padding: 15px;
        background-color: white;
        border-radius: 5px;
        border: 1px solid #ddd;
      }
      
      .control-section h5 {
        margin: 0 0 10px 0;
        padding-bottom: 5px;
        border-bottom: 2px solid #818181;
        color: #333;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .control-section h5:hover {
        color: #818181;
      }
      
      .control-content {
        display: none;
        margin-top: 10px;
      }
      
      .control-content.active {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      
      .control-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        width: 100%;
      }
      
      .control-item {
        flex: 1;
        min-width: 150px;
      }
      
      .control-item label {
        display: block;
        margin-bottom: 5px;
        font-size: 13px;
        color: #555;
      }
      
      .control-item input,
      .control-item select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 13px;
      }
      
      .control-item input[type="checkbox"] {
        width: auto;
        margin-right: 5px;
      }
      
      .download-btn {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
        margin-top: 10px;
      }
      
      .download-btn:hover {
        background-color: #45a049;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
      }
      
      .data-table-container {
        margin: 20px 0;
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: white;
      }
      
      .data-table {
        width: 100%;
        border-collapse: collapse;
      }
      
      .data-table th {
        background-color: #818181;
        color: white;
        padding: 12px;
        text-align: center;
        position: sticky;
        top: 0;
        z-index: 10;
        font-weight: 500;
      }
      
      .data-table td {
        padding: 8px;
        text-align: center;
        border-bottom: 1px solid #eee;
      }
      
      .data-table tr:hover {
        background-color: #f5f5f5;
      }
      
      .data-table input {
        width: 100%;
        padding: 6px;
        border: 1px solid #ddd;
        border-radius: 3px;
        text-align: center;
        font-family: 'Courier New', monospace;
      }
      
      .data-table input:focus {
        outline: none;
        border-color: #818181;
        box-shadow: 0 0 0 2px rgba(129, 129, 129, 0.1);
      }
      
      .delete-row-btn {
        background-color: #f44336;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s ease;
      }
      
      .delete-row-btn:hover {
        background-color: #d32f2f;
      }
      
      .add-row-btn {
        background-color: #2196F3;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        margin-top: 10px;
        transition: all 0.3s ease;
      }
      
      .add-row-btn:hover {
        background-color: #1976D2;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
      }
      
      .table-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
      }
    </style>
  </head>
  
  <body>
    <!-- è¿”å›æŒ‰éˆ• -->
    <a href="index.html" class="back-btn">
      â† è¿”å›é¦–é 
    </a>
    
    <!-- é é¢æ¨™é¡Œ -->
    <div class="page-header">
      <div class="container">
        <h1 class="page-title">æ™®ç‰©å¯¦é©—å°å·¥å…·</h1>
        <p class="page-subtitle">æ•¸æ“šåˆ†æèˆ‡è¨ˆç®—å·¥å…·</p>
      </div>
    </div>
    
    <!-- å·¥å…·å…§å®¹ -->
    <div class="tool-container">
      <div class="tool-card">
        <!-- åŠŸèƒ½é¸å–® -->
        <div class="tool-tabs">
          <button class="tab-btn active" onclick="switchTab('uncertainty')">ä¸ç¢ºå®šåº¦èˆ‡çµ±è¨ˆ</button>
          <button class="tab-btn" onclick="switchTab('regression')">å›æ­¸ç›´ç·š</button>
          <button class="tab-btn" onclick="switchTab('propagation')">ä¸ç¢ºå®šåº¦å‚³é</button>
          <button class="tab-btn" onclick="switchTab('equation')">äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹å¼</button>
        </div>
        
        <!-- ä¸ç¢ºå®šåº¦è¨ˆç®—èˆ‡çµ±è¨ˆ -->
        <div id="uncertainty" class="tool-content active">
          <h3>ä¸ç¢ºå®šåº¦è¨ˆç®—èˆ‡åŸºæœ¬çµ±è¨ˆ</h3>
          <div class="input-group">
            <label>è¼¸å…¥æ•¸æ“šï¼ˆæ¯è¡Œä¸€å€‹æ•¸å€¼ï¼‰ï¼š</label>
            <textarea id="uncertaintyData" placeholder="ä¾‹å¦‚ï¼š&#10;10.5&#10;10.3&#10;10.6&#10;10.4"></textarea>
            <p class="hint-text">è«‹è¼¸å…¥æ¸¬é‡æ•¸æ“šï¼Œæ¯å€‹æ•¸å€¼ä¸€è¡Œ</p>
          </div>
          <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div class="input-group" style="flex: 1; min-width: 200px;">
              <label>å„€å™¨æœ€å°åˆ»åº¦ï¼š</label>
              <input type="number" id="minScale" step="any" value="0.1" placeholder="ä¾‹å¦‚ï¼š0.1">
              <p class="hint-text">å„€å™¨çš„æœ€å°åˆ»åº¦å€¼ï¼ˆç”¨æ–¼è¨ˆç®—å„€å™¨ä¸ç¢ºå®šåº¦ï¼‰</p>
            </div>
            <div class="input-group" style="flex: 1; min-width: 200px;">
              <label>å°æ•¸é»ä½æ•¸ï¼š</label>
              <input type="number" id="decimalPlaces" min="0" max="10" step="1" value="2" placeholder="ä¾‹å¦‚ï¼š2">
              <p class="hint-text">çµæœé¡¯ç¤ºçš„å°æ•¸é»ä½æ•¸</p>
            </div>
          </div>
          <button class="calculate-btn" onclick="calculateUncertainty()">è¨ˆç®—</button>
          <div id="uncertaintyResult" class="result-box" style="display: none;">
            <h4>è¨ˆç®—çµæœ</h4>
            <div id="uncertaintyOutput"></div>
          </div>
        </div>
        
        <!-- å›æ­¸ç›´ç·š -->
        <div id="regression" class="tool-content">
          <h3>ç·šæ€§å›æ­¸åˆ†æ</h3>
          
          <!-- æ•¸æ“šè¡¨æ ¼ -->
          <div class="data-table-container">
            <table class="data-table" id="dataTable">
              <thead>
                <tr>
                  <th style="width: 50px;">#</th>
                  <th>X å€¼</th>
                  <th>Y å€¼</th>
                  <th style="width: 80px;">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="dataTableBody">
                <!-- å‹•æ…‹ç”Ÿæˆè¡Œ -->
              </tbody>
            </table>
          </div>
          
          <div class="table-actions">
            <button class="add-row-btn" onclick="addDataRow()">â• æ–°å¢æ•¸æ“šé»</button>
            <button class="add-row-btn" onclick="fillSampleData()">ğŸ“ å¡«å…¥ç¯„ä¾‹æ•¸æ“š</button>
            <button class="add-row-btn" onclick="quickInput()">âš¡ å¿«é€Ÿè¼¸å…¥</button>
            <button class="add-row-btn" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•¸æ“š</button>
            <button class="add-row-btn" onclick="downloadCSV()">ğŸ’¾ ä¸‹è¼‰CSV</button>
          </div>
          
          <div style="margin-top: 15px; display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
            <label>
              <input type="checkbox" id="autoUpdate" checked>
              è‡ªå‹•æ›´æ–°åœ–è¡¨ï¼ˆè¼¸å…¥æ•¸æ“šå¾Œè‡ªå‹•é‡ç¹ªï¼‰
            </label>
            <div style="display: flex; align-items: center; gap: 10px;">
              <label>å°æ•¸é»ä½æ•¸ï¼š</label>
              <input type="number" id="regressionDecimalPlaces" min="0" max="10" step="1" value="6" style="width: 80px;" placeholder="6">
            </div>
          </div>
          
          <button class="calculate-btn" onclick="calculateRegression()" style="margin-top: 15px;">è¨ˆç®—èˆ‡ç¹ªåœ–</button>
          
          <!-- åœ–è¡¨é¡¯ç¤º -->
          <div id="regressionChart" style="display: none;">
            <div class="chart-container">
              <canvas id="regressionCanvas"></canvas>
            </div>
            
            <!-- åŸºæœ¬æ§åˆ¶ -->
            <div class="chart-controls">
              <div class="input-group" style="flex: 2; min-width: 250px;">
                <label>åœ–è¡¨æ¨™é¡Œï¼š</label>
                <input type="text" id="chartTitle" value="ç·šæ€§å›æ­¸åˆ†æ" onchange="updateChart()">
              </div>
              <div class="input-group">
                <label>X è»¸æ¨™ç±¤ï¼š</label>
                <input type="text" id="xAxisLabel" value="X" onchange="updateChart()">
              </div>
              <div class="input-group">
                <label>Y è»¸æ¨™ç±¤ï¼š</label>
                <input type="text" id="yAxisLabel" value="Y" onchange="updateChart()">
              </div>
              <div class="input-group">
                <label>ä¸‹è¼‰èƒŒæ™¯ï¼š</label>
                <select id="downloadBackground" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                  <option value="white">ç™½è‰²èƒŒæ™¯</option>
                  <option value="transparent">é€æ˜èƒŒæ™¯</option>
                </select>
              </div>
              <button class="download-btn" onclick="downloadChart()">â¬‡ï¸ ä¸‹è¼‰åœ–è¡¨ (PNG)</button>
            </div>
            
            <!-- é€²éšæ§åˆ¶ -->
            <div class="control-section">
              <h5 onclick="toggleSection('fontControl')">
                ğŸ”¤ å­—é«”è¨­å®š
                <span id="fontControlIcon">â–¼</span>
              </h5>
              <div id="fontControl" class="control-content">
                <div class="control-item">
                  <label>æ¨™é¡Œå­—é«”å¤§å°ï¼š</label>
                  <input type="number" id="titleFontSize" value="18" min="10" max="36" onchange="updateChart()">
                </div>
                <div class="control-item">
                  <label>æ¨™é¡Œå­—é«”ç²—ç´°ï¼š</label>
                  <select id="titleFontWeight" onchange="updateChart()">
                    <option value="normal">æ­£å¸¸</option>
                    <option value="bold" selected>ç²—é«”</option>
                  </select>
                </div>
                <div class="control-item">
                  <label>åæ¨™è»¸å­—é«”å¤§å°ï¼š</label>
                  <input type="number" id="axisLabelFontSize" value="14" min="8" max="24" onchange="updateChart()">
                </div>
                <div class="control-item">
                  <label>åæ¨™è»¸åˆ»åº¦å­—é«”ï¼š</label>
                  <input type="number" id="axisTickFontSize" value="12" min="8" max="20" onchange="updateChart()">
                </div>
              </div>
            </div>
            
            <div class="control-section">
              <h5 onclick="toggleSection('gridControl')">
                ğŸ—„ ç¶²æ ¼ç·šè¨­å®š
                <span id="gridControlIcon">â–¼</span>
              </h5>
              <div id="gridControl" class="control-content">
                <div class="control-item">
                  <label>
                    <input type="checkbox" id="showXGrid" checked onchange="updateChart()">
                    Xè»¸ä¸»ç¶²æ ¼ç·š
                  </label>
                </div>
                <div class="control-item">
                  <label>
                    <input type="checkbox" id="showYGrid" checked onchange="updateChart()">
                    Yè»¸ä¸»ç¶²æ ¼ç·š
                  </label>
                </div>
                <div class="control-item">
                  <label>
                    <input type="checkbox" id="showXMinorGrid" onchange="updateChart()">
                    Xè»¸æ¬¡ç¶²æ ¼ç·š
                  </label>
                </div>
                <div class="control-item">
                  <label>
                    <input type="checkbox" id="showYMinorGrid" onchange="updateChart()">
                    Yè»¸æ¬¡ç¶²æ ¼ç·š
                  </label>
                </div>
              </div>
            </div>
            
            <div class="control-section">
              <h5 onclick="toggleSection('axisControl')">
                ğŸ“Š åæ¨™è»¸è¨­å®š
                <span id="axisControlIcon">â–¼</span>
              </h5>
              <div id="axisControl" class="control-content">
                <div class="control-item">
                  <label>Xè»¸ä¸»é–“éš”ï¼š</label>
                  <input type="number" id="xAxisStep" step="any" placeholder="è‡ªå‹•" onchange="updateChart()">
                </div>
                <div class="control-item">
                  <label>Yè»¸ä¸»é–“éš”ï¼š</label>
                  <input type="number" id="yAxisStep" step="any" placeholder="è‡ªå‹•" onchange="updateChart()">
                </div>
                <div class="control-item">
                  <label>Xè»¸æ¬¡é–“éš”æ•¸ï¼š</label>
                  <input type="number" id="xMinorTicks" value="5" min="0" max="10" onchange="updateChart()">
                </div>
                <div class="control-item">
                  <label>Yè»¸æ¬¡é–“éš”æ•¸ï¼š</label>
                  <input type="number" id="yMinorTicks" value="5" min="0" max="10" onchange="updateChart()">
                </div>
              </div>
            </div>
            
            <div class="control-section">
              <h5 onclick="toggleSection('dataPointControl')">
                â— æ•¸æ“šé»è¨­å®š
                <span id="dataPointControlIcon">â–¼</span>
              </h5>
              <div id="dataPointControl" class="control-content">
                <div class="control-item">
                  <label>æ•¸æ“šé»å¤§å°ï¼š</label>
                  <input type="number" id="pointRadius" value="6" min="2" max="15" onchange="updateChart()">
                </div>
                <div class="control-item">
                  <label>æ•¸æ“šé»æ¨£å¼ï¼š</label>
                  <select id="pointStyle" onchange="updateChart()">
                    <option value="circle" selected>åœ“å½¢</option>
                    <option value="rect">æ–¹å½¢</option>
                    <option value="triangle">ä¸‰è§’å½¢</option>
                    <option value="cross">åå­—</option>
                    <option value="star">æ˜Ÿå½¢</option>
                  </select>
                </div>
                <div class="control-item">
                  <label>æ•¸æ“šé»é¡è‰²ï¼š</label>
                  <input type="color" id="pointColor" value="#818181" onchange="updateChart()">
                </div>
                <div class="control-item">
                  <label>æ•¸æ“šé»é‚Šæ¡†å¯¬åº¦ï¼š</label>
                  <input type="number" id="pointBorderWidth" value="2" min="0" max="5" onchange="updateChart()">
                </div>
              </div>
            </div>
            
            <div class="control-section">
              <h5 onclick="toggleSection('regressionLineControl')">
                ğŸ“Š å›æ­¸ç›´ç·šè¨­å®š
                <span id="regressionLineControlIcon">â–¼</span>
              </h5>
              <div id="regressionLineControl" class="control-content">
                <div class="control-item">
                  <label>
                    <input type="checkbox" id="showRegressionLine" checked onchange="updateChart()">
                    é¡¯ç¤ºå›æ­¸ç›´ç·š
                  </label>
                </div>
                <div class="control-item">
                  <label>ç›´ç·šå¯¬åº¦ï¼š</label>
                  <input type="number" id="lineWidth" value="2" min="1" max="10" onchange="updateChart()">
                </div>
                <div class="control-item">
                  <label>ç›´ç·šæ¨£å¼ï¼š</label>
                  <select id="lineStyle" onchange="updateChart()">
                    <option value="solid" selected>å¯¦ç·š</option>
                    <option value="dashed">è™›ç·š</option>
                    <option value="dotted">é»ç·š</option>
                  </select>
                </div>
                <div class="control-item">
                  <label>ç›´ç·šé¡è‰²ï¼š</label>
                  <input type="color" id="lineColor" value="#ff6384" onchange="updateChart()">
                </div>
              </div>
            </div>
          </div>
          
          <div id="regressionResult" class="result-box" style="display: none;">
            <h4>è¨ˆç®—çµæœ</h4>
            <div id="regressionOutput"></div>
          </div>
        </div>
        
        <!-- ä¸ç¢ºå®šåº¦å‚³é -->
        <div id="propagation" class="tool-content">
          <h3>ä¸ç¢ºå®šåº¦å‚³éè¨ˆç®—</h3>
          <div class="input-group">
            <label>é¸æ“‡å…¬å¼é¡å‹ï¼š</label>
            <select id="propagationType" onchange="updatePropagationInputs()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="add">åŠ æ³•/æ¸›æ³•: f = A Â± B</option>
              <option value="multiply">ä¹˜æ³•/é™¤æ³•: f = A Ã— B æˆ– A / B</option>
              <option value="power">å†ªæ¬¡: f = A^n</option>
              <option value="custom">è‡ªè¨‚å…¬å¼</option>
            </select>
          </div>
          <div id="propagationInputs">
            <div class="input-group">
              <label>A å€¼ï¼š</label>
              <input type="number" id="propA" step="any">
            </div>
            <div class="input-group">
              <label>A çš„ä¸ç¢ºå®šåº¦ (Î”A)ï¼š</label>
              <input type="number" id="propDeltaA" step="any">
            </div>
            <div class="input-group">
              <label>B å€¼ï¼š</label>
              <input type="number" id="propB" step="any">
            </div>
            <div class="input-group">
              <label>B çš„ä¸ç¢ºå®šåº¦ (Î”B)ï¼š</label>
              <input type="number" id="propDeltaB" step="any">
            </div>
          </div>
          <button class="calculate-btn" onclick="calculatePropagation()">è¨ˆç®—</button>
          <div id="propagationResult" class="result-box" style="display: none;">
            <h4>è¨ˆç®—çµæœ</h4>
            <div id="propagationOutput"></div>
          </div>
        </div>
        
        <!-- äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹å¼ -->
        <div id="equation" class="tool-content">
          <h3>äºŒå…ƒä¸€æ¬¡è¯ç«‹æ–¹ç¨‹å¼æ±‚è§£</h3>
          <p style="margin-bottom: 20px; color: #666;">æ±‚è§£æ–¹ç¨‹å¼çµ„ï¼š<br>
          aâ‚x + bâ‚y = câ‚<br>
          aâ‚‚x + bâ‚‚y = câ‚‚</p>
          <div class="input-group">
            <label>ç¬¬ä¸€å¼ - aâ‚ï¼ˆx çš„ä¿‚æ•¸ï¼‰ï¼š</label>
            <input type="number" id="eqA1" step="any" placeholder="ä¾‹å¦‚ï¼š2">
          </div>
          <div class="input-group">
            <label>ç¬¬ä¸€å¼ - bâ‚ï¼ˆy çš„ä¿‚æ•¸ï¼‰ï¼š</label>
            <input type="number" id="eqB1" step="any" placeholder="ä¾‹å¦‚ï¼š3">
          </div>
          <div class="input-group">
            <label>ç¬¬ä¸€å¼ - câ‚ï¼ˆå¸¸æ•¸é …ï¼‰ï¼š</label>
            <input type="number" id="eqC1" step="any" placeholder="ä¾‹å¦‚ï¼š13">
          </div>
          <div class="input-group">
            <label>ç¬¬äºŒå¼ - aâ‚‚ï¼ˆx çš„ä¿‚æ•¸ï¼‰ï¼š</label>
            <input type="number" id="eqA2" step="any" placeholder="ä¾‹å¦‚ï¼š4">
          </div>
          <div class="input-group">
            <label>ç¬¬äºŒå¼ - bâ‚‚ï¼ˆy çš„ä¿‚æ•¸ï¼‰ï¼š</label>
            <input type="number" id="eqB2" step="any" placeholder="ä¾‹å¦‚ï¼š-1">
          </div>
          <div class="input-group">
            <label>ç¬¬äºŒå¼ - câ‚‚ï¼ˆå¸¸æ•¸é …ï¼‰ï¼š</label>
            <input type="number" id="eqC2" step="any" placeholder="ä¾‹å¦‚ï¼š5">
          </div>
          <button class="calculate-btn" onclick="solveEquations()">æ±‚è§£</button>
          <div id="equationResult" class="result-box" style="display: none;">
            <h4>è¨ˆç®—çµæœ</h4>
            <div id="equationOutput"></div>
          </div>
        </div>
        
      </div>
      
      <!-- é å°¾é€£çµ -->
      <div class="footer-links">
        <a href="https://line.me/ti/p/07D9gJpuT6" target="_blank">è¯çµ¡ä½œè€…</a>
        <span style="color: #ccc;">|</span>
        <a href="https://sites.google.com/view/ntnu-general-phy-lab/%E6%AA%94%E6%A1%88%E5%88%86%E4%BA%AB/%E5%AF%A6%E9%A9%97%E5%85%A7%E5%AE%B9" target="_blank">æ™®ç‰©å¯¦é©—è¬›ç¾©</a>
        <span style="color: #ccc;">|</span>
        <a href="https://drive.google.com/file/d/11-np-5bq9sse7b9Eb7KIk0qJ6ilK6iNH/view?usp=drive_link" target="_blank">æ™®ç‰©å¯¦é©—å·¥å…·(é›»è…¦ç‰ˆ)</a>
        <span style="color: #ccc;">|</span>
        <a href="index.html">è¿”å›é¦–é </a>
      </div>
    </div>
    
    <script>
      // åˆ‡æ›åŠŸèƒ½åˆ†é 
      function switchTab(tabName) {
        // éš±è—æ‰€æœ‰å…§å®¹
        const contents = document.querySelectorAll('.tool-content');
        contents.forEach(content => content.classList.remove('active'));
        
        // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active ç‹€æ…‹
        const buttons = document.querySelectorAll('.tab-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        
        // é¡¯ç¤ºé¸ä¸­çš„å…§å®¹
        document.getElementById(tabName).classList.add('active');
        
        // è¨­ç½®æŒ‰éˆ•ç‚º active
        event.target.classList.add('active');
      }
      
      // ä¸ç¢ºå®šåº¦è¨ˆç®—èˆ‡çµ±è¨ˆ
      function calculateUncertainty() {
        const dataText = document.getElementById('uncertaintyData').value;
        const data = dataText.split('\n')
          .map(line => parseFloat(line.trim()))
          .filter(num => !isNaN(num));
        
        if (data.length === 0) {
          alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸æ“šï¼');
          return;
        }
        
        const minScale = parseFloat(document.getElementById('minScale').value) || 0.1;
        const decimalPlaces = parseInt(document.getElementById('decimalPlaces').value) || 2;
        
        // æ’åºæ•¸æ“šç”¨æ–¼è¨ˆç®—ä¸­ä½æ•¸å’Œæœ€å¤§æœ€å°å€¼
        const sortedData = [...data].sort((a, b) => a - b);
        
        const n = data.length;
        const sum = data.reduce((acc, val) => acc + val, 0);
        const mean = sum / n;
        const min = sortedData[0];
        const max = sortedData[n - 1];
        const range = max - min;
        
        // è¨ˆç®—ä¸­ä½æ•¸
        let median;
        if (n % 2 === 0) {
          median = (sortedData[n/2 - 1] + sortedData[n/2]) / 2;
        } else {
          median = sortedData[Math.floor(n/2)];
        }
        
        // æ¨£æœ¬æ¨™æº–å·®ï¼ˆé™¤ä»¥ n-1ï¼Œè²å¡çˆ¾æ ¡æ­£ï¼‰
        const sampleVariance = data.reduce((acc, val) => acc + Math.pow(val - mean, 2), 0) / (n - 1);
        const sampleStdDev = Math.sqrt(sampleVariance);
        
        // æ¯é«”æ¨™æº–å·®ï¼ˆé™¤ä»¥ nï¼‰
        const populationVariance = data.reduce((acc, val) => acc + Math.pow(val - mean, 2), 0) / n;
        const populationStdDev = Math.sqrt(populationVariance);
        
        const stdError = sampleStdDev / Math.sqrt(n);
        
        // è¨ˆç®—å„€å™¨ä¸ç¢ºå®šåº¦ï¼ˆæœ€å°åˆ»åº¦çš„ä¸€åŠï¼‰
        const instrumentUncertainty = minScale / 2;
        
        // Aé¡ä¸ç¢ºå®šåº¦ï¼ˆçµ±è¨ˆä¸ç¢ºå®šåº¦ï¼‰
        const typeAUncertainty = stdError;
        
        // Bé¡ä¸ç¢ºå®šåº¦ï¼ˆå„€å™¨ä¸ç¢ºå®šåº¦ï¼‰
        const typeBUncertainty = instrumentUncertainty / Math.sqrt(3);
        
        // ç¸½ä¸ç¢ºå®šåº¦
        const totalUncertainty = Math.sqrt(typeAUncertainty * typeAUncertainty + typeBUncertainty * typeBUncertainty);
        
        const output = `
          <h4 style="margin-top: 0; color: #333;">åŸºæœ¬çµ±è¨ˆé‡</h4>
          <div class="result-item"><strong>æ•¸æ“šå€‹æ•¸ (n)ï¼š</strong>${n}</div>
          <div class="result-item"><strong>ç¸½å’Œï¼š</strong>${sum.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>å¹³å‡å€¼ (xÌ„)ï¼š</strong>${mean.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>ä¸­ä½æ•¸ï¼š</strong>${median.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>æœ€å°å€¼ï¼š</strong>${min.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>æœ€å¤§å€¼ï¼š</strong>${max.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>å…¨è·ï¼š</strong>${range.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>æ¨£æœ¬è®Šç•°æ•¸ (sÂ²)ï¼š</strong>${sampleVariance.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>æ¨£æœ¬æ¨™æº–å·® (s)ï¼š</strong>${sampleStdDev.toFixed(decimalPlaces)} <span style="color: #666; font-size: 12px;">(é™¤ä»¥ n-1)</span></div>
          <div class="result-item"><strong>æ¯é«”æ¨™æº–å·® (Ïƒ)ï¼š</strong>${populationStdDev.toFixed(decimalPlaces)} <span style="color: #666; font-size: 12px;">(é™¤ä»¥ n)</span></div>
          <div class="result-item"><strong>æ¨™æº–èª¤å·® (SE)ï¼š</strong>${stdError.toFixed(decimalPlaces)}</div>
          <div class="result-item" style="margin-top: 20px; padding-top: 15px; border-top: 2px solid #818181;"><h4 style="margin: 0 0 10px 0; color: #333;">ä¸ç¢ºå®šåº¦åˆ†æ</h4></div>
          <div class="result-item"><strong>Aé¡ä¸ç¢ºå®šåº¦ (çµ±è¨ˆ)ï¼š</strong>Â±${typeAUncertainty.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>Bé¡ä¸ç¢ºå®šåº¦ (å„€å™¨)ï¼š</strong>Â±${typeBUncertainty.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>ã€€å„€å™¨æœ€å°åˆ»åº¦ï¼š</strong>${minScale}</div>
          <div class="result-item"><strong>ã€€å„€å™¨ä¸ç¢ºå®šåº¦ï¼š</strong>Â±${instrumentUncertainty.toFixed(decimalPlaces)}</div>
          <div class="result-item" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;"><strong>ç¸½ä¸ç¢ºå®šåº¦ (Î”x)ï¼š</strong>Â±${totalUncertainty.toFixed(decimalPlaces)}</div>
          <div class="result-item" style="font-size: 16px; color: #818181; font-weight: bold; margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-radius: 5px;"><strong>çµæœè¡¨ç¤ºï¼š</strong>x = ${mean.toFixed(decimalPlaces)} Â± ${totalUncertainty.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>ç›¸å°ä¸ç¢ºå®šåº¦ï¼š</strong>${((totalUncertainty/mean)*100).toFixed(2)}%</div>
        `;
        
        document.getElementById('uncertaintyOutput').innerHTML = output;
        document.getElementById('uncertaintyResult').style.display = 'block';
      }
      
      // ç·šæ€§å›æ­¸è¨ˆç®—
      let regressionChartInstance = null;
      let currentRegressionData = null;
      let dataRowCount = 0;
      
      // åˆå§‹åŒ–è¡¨æ ¼
      document.addEventListener('DOMContentLoaded', function() {
        // æ·»åŠ åˆå§‹æ•¸æ“šè¡Œ
        for (let i = 0; i < 5; i++) {
          addDataRow();
        }
      });
      
      // æ–°å¢æ•¸æ“šè¡Œ
      function addDataRow(xValue = '', yValue = '') {
        dataRowCount++;
        const tbody = document.getElementById('dataTableBody');
        const row = document.createElement('tr');
        row.id = `dataRow${dataRowCount}`;
        row.innerHTML = `
          <td>${dataRowCount}</td>
          <td><input type="number" step="any" value="${xValue}" oninput="onDataChange()" placeholder="è¼¸å…¥ X"></td>
          <td><input type="number" step="any" value="${yValue}" oninput="onDataChange()" placeholder="è¼¸å…¥ Y"></td>
          <td><button class="delete-row-btn" onclick="deleteDataRow('dataRow${dataRowCount}')">Ã—</button></td>
        `;
        tbody.appendChild(row);
      }
      
      // åˆªé™¤æ•¸æ“šè¡Œ
      function deleteDataRow(rowId) {
        const row = document.getElementById(rowId);
        if (row) {
          row.remove();
          updateRowNumbers();
          onDataChange();
        }
      }
      
      // æ›´æ–°è¡Œè™Ÿ
      function updateRowNumbers() {
        const rows = document.querySelectorAll('#dataTableBody tr');
        rows.forEach((row, index) => {
          row.cells[0].textContent = index + 1;
        });
      }
      
      // å¡«å…¥ç¯„ä¾‹æ•¸æ“š
      function fillSampleData() {
        clearAllData();
        const sampleData = [
          [1, 2.1],
          [2, 4.2],
          [3, 5.9],
          [4, 8.1],
          [5, 10.2]
        ];
        sampleData.forEach(([x, y]) => addDataRow(x, y));
        onDataChange();
      }
      
      // å¿«é€Ÿè¼¸å…¥æ•¸æ“š
      function quickInput() {
        const n = prompt('è«‹è¼¸å…¥æ•¸æ“šé»æ•¸ç›®ï¼š', '5');
        if (!n || isNaN(n) || parseInt(n) < 1) {
          if (n !== null) alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸æ“šé»æ•¸ç›®ï¼');
          return;
        }
        
        const count = parseInt(n);
        if (count > REGRESSION_MAX_POINTS) {
          alert(`æ•¸æ“šé»éå¤šï¼ˆ${count}ï¼‰ï¼Œç‚ºé¿å…ç€è¦½å™¨è¨˜æ†¶é«”ä¸è¶³ï¼Œè«‹æ¸›å°‘åˆ° ${REGRESSION_MAX_POINTS} ä»¥ä¸‹ã€‚`);
          return;
        }
        const data = [];
        
        for (let i = 1; i <= count; i++) {
          const x = prompt(`è«‹è¼¸å…¥ X${i}ï¼š`, '');
          if (x === null) return; // ç”¨æˆ¶å–æ¶ˆ
          
          const y = prompt(`è«‹è¼¸å…¥ Y${i}ï¼š`, '');
          if (y === null) return; // ç”¨æˆ¶å–æ¶ˆ
          
          data.push({ x: x, y: y });
        }
        
        // æ¸…ç©ºç¾æœ‰æ•¸æ“š
        clearAllData();
        
        // æ·»åŠ æ–°æ•¸æ“š
        data.forEach(point => {
          addDataRow(point.x, point.y);
        });
        
        alert(`æˆåŠŸè¼¸å…¥ ${count} å€‹æ•¸æ“šé»ï¼`);
        
        // å¦‚æœé–‹å•Ÿè‡ªå‹•æ›´æ–°ï¼Œå‰‡è‡ªå‹•è¨ˆç®—
        if (document.getElementById('autoUpdate').checked) {
          calculateRegression();
        }
      }
      
      // ä¸‹è¼‰CSVæª”æ¡ˆ
      function downloadCSV() {
        const { xData, yData } = getTableData();
        if (xData.length === 0) {
          alert('è«‹å…ˆè¼¸å…¥æ•¸æ“šï¼');
          return;
        }
        
        // å»ºç«‹CSVå…§å®¹
        let csvContent = 'X,Y\n';
        for (let i = 0; i < xData.length; i++) {
          csvContent += `${xData[i]},${yData[i]}\n`;
        }
        
        // å»ºç«‹ä¸‹è¼‰é€£çµ
        const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `regression_data_${new Date().getTime()}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // é‡‹æ”¾ ObjectURLï¼Œé¿å…å¤§é‡ä¸‹è¼‰é€ æˆè¨˜æ†¶é«”ç´¯ç©
        setTimeout(() => URL.revokeObjectURL(url), 0);
      }
      
      // æ¸…é™¤æ‰€æœ‰æ•¸æ“š
      function clearAllData() {
        document.getElementById('dataTableBody').innerHTML = '';
        dataRowCount = 0;
        if (regressionChartInstance) {
          regressionChartInstance.destroy();
          regressionChartInstance = null;
        }
        document.getElementById('regressionChart').style.display = 'none';
        document.getElementById('regressionResult').style.display = 'none';
      }
      
      // å¾è¡¨æ ¼ç²å–æ•¸æ“š
      function getTableData() {
        const rows = document.querySelectorAll('#dataTableBody tr');
        const xData = [];
        const yData = [];
        
        rows.forEach(row => {
          const xInput = row.cells[1].querySelector('input');
          const yInput = row.cells[2].querySelector('input');
          const x = parseFloat(xInput.value);
          const y = parseFloat(yInput.value);
          
          if (!isNaN(x) && !isNaN(y)) {
            xData.push(x);
            yData.push(y);
          }
        });
        
        return { xData, yData };
      }
      
      // æ•¸æ“šè®Šæ›´æ™‚çš„è™•ç†
      function onDataChange() {
        const autoUpdate = document.getElementById('autoUpdate').checked;
        if (autoUpdate) {
          scheduleRegressionCalculation();
        }
      }

      // é˜²æ­¢è¼¸å…¥æ™‚æ¯å€‹å­—å…ƒéƒ½é‡ç¹ªåœ–è¡¨é€ æˆæ•ˆèƒ½/è¨˜æ†¶é«”å£“åŠ›
      const REGRESSION_DEBOUNCE_MS = 250;
      const REGRESSION_MAX_POINTS = 5000;
      let regressionUpdateTimer = null;

      function scheduleRegressionCalculation() {
        if (regressionUpdateTimer) {
          clearTimeout(regressionUpdateTimer);
        }
        regressionUpdateTimer = setTimeout(() => {
          calculateRegression({ silent: true });
        }, REGRESSION_DEBOUNCE_MS);
      }
      
      // åˆ‡æ›æ§åˆ¶é¢æ¿
      function toggleSection(sectionId) {
        const content = document.getElementById(sectionId);
        const icon = document.getElementById(sectionId + 'Icon');
        if (content.classList.contains('active')) {
          content.classList.remove('active');
          icon.textContent = '\u25bc';
        } else {
          content.classList.add('active');
          icon.textContent = '\u25b2';
        }
      }
      
      function calculateRegression(options = {}) {
        const silent = options && options.silent === true;
        const { xData, yData } = getTableData();
        
        if (xData.length === 0 || yData.length === 0) {
          if (!silent) alert('è«‹è‡³å°‘è¼¸å…¥ä¸€çµ„æœ‰æ•ˆçš„ X å’Œ Y æ•¸æ“šï¼');
          return;
        }

        if (xData.length < 2) {
          if (!silent) alert('éœ€è¦è‡³å°‘å…©å€‹æ•¸æ“šé»æ‰èƒ½é€²è¡Œç·šæ€§å›æ­¸ï¼');
          return;
        }

        if (xData.length > REGRESSION_MAX_POINTS) {
          if (!silent) alert(`æ•¸æ“šé»éå¤šï¼ˆ${xData.length}ï¼‰ï¼Œç‚ºé¿å…ç€è¦½å™¨è¨˜æ†¶é«”ä¸è¶³ï¼Œè«‹æ¸›å°‘åˆ° ${REGRESSION_MAX_POINTS} ä»¥ä¸‹å†è¨ˆç®—ã€‚`);
          return;
        }
        
        const n = xData.length;
        const sumX = xData.reduce((sum, val) => sum + val, 0);
        const sumY = yData.reduce((sum, val) => sum + val, 0);
        const sumXY = xData.reduce((sum, val, i) => sum + val * yData[i], 0);
        const sumX2 = xData.reduce((sum, val) => sum + val * val, 0);
        const sumY2 = yData.reduce((sum, val) => sum + val * val, 0);
        
        // è¨ˆç®—å¹³å‡å€¼
        const meanX = sumX / n;
        const meanY = sumY / n;
        
        // è¨ˆç®—æ¯é«”æ¨™æº–å·®
        const varianceX = xData.reduce((sum, x) => sum + Math.pow(x - meanX, 2), 0) / n;
        const varianceY = yData.reduce((sum, y) => sum + Math.pow(y - meanY, 2), 0) / n;
        const stdDevX = Math.sqrt(varianceX);
        const stdDevY = Math.sqrt(varianceY);
        
        // è¨ˆç®—æ–œç‡å’Œæˆªè·
        const delta = (n * sumX2 - sumX * sumX);
        if (!isFinite(delta) || Math.abs(delta) < 1e-12) {
          if (!silent) alert('ç„¡æ³•é€²è¡Œç·šæ€§å›æ­¸ï¼šæ‰€æœ‰ X å€¼å¤ªæ¥è¿‘æˆ–ç›¸åŒï¼Œå°è‡´ Î” æ¥è¿‘ 0ã€‚');
          return;
        }
        const slope = (n * sumXY - sumX * sumY) / delta;
        const intercept = (sumY * sumX2 - sumXY * sumX) / delta;
        
        // è¨ˆç®—æ®˜å·®å¹³æ–¹å’Œ
        const yPred = xData.map(x => slope * x + intercept);
        const residuals = yData.map((y, i) => y - yPred[i]);
        const ssr = residuals.reduce((sum, r) => sum + r * r, 0);
        
        // è¨ˆç®—æ–œç‡å’Œæˆªè·çš„ä¸ç¢ºå®šåº¦
        const sigma2 = ssr / (n - 2);
        const sigmaSlope = Math.sqrt((n * sigma2) / delta);
        const sigmaIntercept = Math.sqrt((sigma2 * sumX2) / delta);
        
        // è¨ˆç®—ç›¸é—œä¿‚æ•¸
        const sst = yData.reduce((sum, y) => sum + Math.pow(y - meanY, 2), 0);
        let r2;
        if (!isFinite(sst) || Math.abs(sst) < 1e-12) {
          // y å…¨éƒ¨ç›¸åŒæ™‚ sst = 0ï¼Œé¿å… NaN
          r2 = (Math.abs(ssr) < 1e-12) ? 1 : 0;
        } else {
          r2 = 1 - (ssr / sst);
        }
        r2 = Math.max(0, Math.min(1, r2));
        const r = Math.sqrt(r2) * (slope > 0 ? 1 : -1);
        
        // ä¿å­˜ç•¶å‰æ•¸æ“šä¾›æ›´æ–°åœ–è¡¨ä½¿ç”¨
        currentRegressionData = {
          xData, yData, slope, intercept, r, r2, n
        };
        
        // å–å¾—å°æ•¸é»ä½æ•¸è¨­å®š
        const decimalPlaces = parseInt(document.getElementById('regressionDecimalPlaces').value) || 6;
        
        const output = `
          <div class="result-item"><strong>æ•¸æ“šé»æ•¸ (n)ï¼š</strong>${n}</div>
          <div class="result-item" style="font-size: 16px; color: #818181; font-weight: bold; margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-radius: 5px;"><strong>å›æ­¸æ–¹ç¨‹å¼ï¼š</strong>y = (${slope.toFixed(decimalPlaces)} Â± ${sigmaSlope.toFixed(decimalPlaces)})x + (${intercept.toFixed(decimalPlaces)} Â± ${sigmaIntercept.toFixed(decimalPlaces)})</div>
          <div class="result-item"><strong>æ–œç‡ (b)ï¼š</strong>${slope.toFixed(decimalPlaces)} Â± ${sigmaSlope.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>æˆªè· (a)ï¼š</strong>${intercept.toFixed(decimalPlaces)} Â± ${sigmaIntercept.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>ç›¸é—œä¿‚æ•¸ (r)ï¼š</strong>${r.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>æ±ºå®šä¿‚æ•¸ (RÂ²)ï¼š</strong>${r2.toFixed(decimalPlaces)}</div>
          <div class="result-item" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;"><strong>xç¸½å’Œ (Î£x)ï¼š</strong>${sumX.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>yç¸½å’Œ (Î£y)ï¼š</strong>${sumY.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>xå¹³æ–¹ç¸½å’Œ (Î£xÂ²)ï¼š</strong>${sumX2.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>yå¹³æ–¹ç¸½å’Œ (Î£yÂ²)ï¼š</strong>${sumY2.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>xyç¸½å’Œ (Î£xy)ï¼š</strong>${sumXY.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>xæ¯é«”æ¨™æº–å·® (Ïƒx)ï¼š</strong>${stdDevX.toFixed(decimalPlaces)}</div>
          <div class="result-item"><strong>yæ¯é«”æ¨™æº–å·® (Ïƒy)ï¼š</strong>${stdDevY.toFixed(decimalPlaces)}</div>
        `;
        
        document.getElementById('regressionOutput').innerHTML = output;
        document.getElementById('regressionResult').style.display = 'block';
        
        // é¡¯ç¤ºåœ–è¡¨
        document.getElementById('regressionChart').style.display = 'block';
        drawRegressionChart();
      }
      
      function drawRegressionChart() {
        if (!currentRegressionData) return;
        
        const { xData, yData, slope, intercept } = currentRegressionData;
        
        // ç”Ÿæˆå›æ­¸ç›´ç·šçš„é»
        // é¿å…å¤§é‡è³‡æ–™æ™‚ä½¿ç”¨å±•é–‹é‹ç®—å­é€ æˆè¨˜æ†¶é«”/å‘¼å«å †ç–Šå£“åŠ›
        const minX = xData.reduce((min, v) => (v < min ? v : min), xData[0]);
        const maxX = xData.reduce((max, v) => (v > max ? v : max), xData[0]);
        const lineX = [minX, maxX];
        const lineY = lineX.map(x => slope * x + intercept);
        
        const ctx = document.getElementById('regressionCanvas');

        function buildRegressionChartConfig() {
          // ç²å–æ§åˆ¶å€¼
          const chartTitle = document.getElementById('chartTitle').value;
          const xAxisLabel = document.getElementById('xAxisLabel').value;
          const yAxisLabel = document.getElementById('yAxisLabel').value;

          const titleFontSize = parseInt(document.getElementById('titleFontSize').value) || 18;
          const titleFontWeight = document.getElementById('titleFontWeight').value;
          const axisLabelFontSize = parseInt(document.getElementById('axisLabelFontSize').value) || 14;
          const axisTickFontSize = parseInt(document.getElementById('axisTickFontSize').value) || 12;

          const showXGrid = document.getElementById('showXGrid').checked;
          const showYGrid = document.getElementById('showYGrid').checked;
          const showXMinorGrid = document.getElementById('showXMinorGrid').checked;
          const showYMinorGrid = document.getElementById('showYMinorGrid').checked;

          const xAxisStep = parseFloat(document.getElementById('xAxisStep').value) || undefined;
          const yAxisStep = parseFloat(document.getElementById('yAxisStep').value) || undefined;
          const xMinorTicks = parseInt(document.getElementById('xMinorTicks').value) || 5;
          const yMinorTicks = parseInt(document.getElementById('yMinorTicks').value) || 5;

          const pointRadius = parseInt(document.getElementById('pointRadius').value) || 6;
          const pointStyle = document.getElementById('pointStyle').value;
          const pointColor = document.getElementById('pointColor').value;
          const pointBorderWidth = parseInt(document.getElementById('pointBorderWidth').value) || 2;

          const showRegressionLine = document.getElementById('showRegressionLine').checked;
          const lineWidth = parseInt(document.getElementById('lineWidth').value) || 2;
          const lineStyle = document.getElementById('lineStyle').value;
          const lineColor = document.getElementById('lineColor').value;

          // è¨­å®šç·šæ¢æ¨£å¼
          let borderDash = [];
          if (lineStyle === 'dashed') {
            borderDash = [10, 5];
          } else if (lineStyle === 'dotted') {
            borderDash = [2, 3];
          }

          // æº–å‚™æ•¸æ“šé›†
          const datasets = [
            {
              label: 'å¯¦é©—æ•¸æ“š',
              data: xData.map((x, i) => ({ x: x, y: yData[i] })),
              backgroundColor: pointColor,
              borderColor: pointColor,
              pointRadius: pointRadius,
              pointHoverRadius: pointRadius + 2,
              pointStyle: pointStyle,
              borderWidth: pointBorderWidth
            }
          ];

          if (showRegressionLine) {
            datasets.push({
              label: `å›æ­¸ç›´ç·š: y = ${slope.toFixed(4)}x ${intercept >= 0 ? '+' : ''} ${intercept.toFixed(4)}`,
              data: lineX.map((x, i) => ({ x: x, y: lineY[i] })),
              type: 'line',
              borderColor: lineColor,
              backgroundColor: lineColor + '20',
              borderWidth: lineWidth,
              borderDash: borderDash,
              pointRadius: 0,
              fill: false
            });
          }

          const options = {
            responsive: true,
            maintainAspectRatio: false,
            animation: false,
            parsing: false,
            normalized: true,
            plugins: {
              title: {
                display: true,
                text: chartTitle,
                font: {
                  size: titleFontSize,
                  weight: titleFontWeight
                }
              },
              legend: {
                display: true,
                position: 'top'
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `(${context.parsed.x.toFixed(2)}, ${context.parsed.y.toFixed(2)})`;
                  }
                }
              }
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: xAxisLabel,
                  font: {
                    size: axisLabelFontSize,
                    weight: 'bold'
                  }
                },
                ticks: {
                  font: {
                    size: axisTickFontSize
                  },
                  stepSize: xAxisStep,
                  autoSkip: false,
                  callback: function(value, index, ticks) {
                    const tick = ticks && ticks[index];
                    if (tick && tick.major === false) return '';
                    return Number(value).toFixed(2);
                  }
                },
                afterBuildTicks: function(axis) {
                  if (!(showXMinorGrid && xMinorTicks > 0)) return;

                  const min = axis.min;
                  const max = axis.max;
                  if (!isFinite(min) || !isFinite(max) || max <= min) return;

                  const majorStep = xAxisStep || (max - min) / 5;
                  if (!isFinite(majorStep) || majorStep <= 0) return;

                  const minorStep = majorStep / (xMinorTicks + 1);
                  if (!isFinite(minorStep) || minorStep <= 0) return;

                  const maxTicks = 2000;
                  const ticks = [];
                  let current = Math.floor(min / minorStep) * minorStep;
                  let safety = 0;
                  const end = max + minorStep / 2;

                  while (current <= end && safety < maxTicks) {
                    const normalized = Math.abs((current - min) % majorStep);
                    const isMajor = normalized < 1e-8 || normalized > majorStep - 1e-8;
                    ticks.push({ value: current, major: isMajor });
                    current += minorStep;
                    safety++;
                  }

                  if (safety < maxTicks) {
                    axis.ticks = ticks;
                  }
                },
                grid: {
                  display: true,
                  drawTicks: true,
                  color: function(context) {
                    if (!context.tick) return 'rgba(0, 0, 0, 0.1)';
                    if (showXMinorGrid && context.tick.major === false) {
                      return 'rgba(0, 0, 0, 0.05)';
                    }
                    if (showXGrid && context.tick.major !== false) {
                      return 'rgba(0, 0, 0, 0.1)';
                    }
                    return 'transparent';
                  },
                  lineWidth: function(context) {
                    if (!context.tick) return 1;
                    if (showXMinorGrid && context.tick.major === false) {
                      return 0.5;
                    }
                    return 1;
                  }
                }
              },
              y: {
                title: {
                  display: true,
                  text: yAxisLabel,
                  font: {
                    size: axisLabelFontSize,
                    weight: 'bold'
                  }
                },
                ticks: {
                  font: {
                    size: axisTickFontSize
                  },
                  stepSize: yAxisStep,
                  autoSkip: false,
                  callback: function(value, index, ticks) {
                    const tick = ticks && ticks[index];
                    if (tick && tick.major === false) return '';
                    return Number(value).toFixed(2);
                  }
                },
                afterBuildTicks: function(axis) {
                  if (!(showYMinorGrid && yMinorTicks > 0)) return;

                  const min = axis.min;
                  const max = axis.max;
                  if (!isFinite(min) || !isFinite(max) || max <= min) return;

                  const majorStep = yAxisStep || (max - min) / 5;
                  if (!isFinite(majorStep) || majorStep <= 0) return;

                  const minorStep = majorStep / (yMinorTicks + 1);
                  if (!isFinite(minorStep) || minorStep <= 0) return;

                  const maxTicks = 2000;
                  const ticks = [];
                  let current = Math.floor(min / minorStep) * minorStep;
                  let safety = 0;
                  const end = max + minorStep / 2;

                  while (current <= end && safety < maxTicks) {
                    const normalized = Math.abs((current - min) % majorStep);
                    const isMajor = normalized < 1e-8 || normalized > majorStep - 1e-8;
                    ticks.push({ value: current, major: isMajor });
                    current += minorStep;
                    safety++;
                  }

                  if (safety < maxTicks) {
                    axis.ticks = ticks;
                  }
                },
                grid: {
                  display: true,
                  drawTicks: true,
                  color: function(context) {
                    if (!context.tick) return 'rgba(0, 0, 0, 0.1)';
                    if (showYMinorGrid && context.tick.major === false) {
                      return 'rgba(0, 0, 0, 0.05)';
                    }
                    if (showYGrid && context.tick.major !== false) {
                      return 'rgba(0, 0, 0, 0.1)';
                    }
                    return 'transparent';
                  },
                  lineWidth: function(context) {
                    if (!context.tick) return 1;
                    if (showYMinorGrid && context.tick.major === false) {
                      return 0.5;
                    }
                    return 1;
                  }
                }
              }
            }
          };

          return {
            type: 'scatter',
            data: { datasets: datasets },
            options: options
          };
        }

        const config = buildRegressionChartConfig();
        if (!regressionChartInstance) {
          regressionChartInstance = new Chart(ctx, config);
        } else {
          regressionChartInstance.data = config.data;
          regressionChartInstance.options = config.options;
          regressionChartInstance.update();
        }
      }
      
      // æ§åˆ¶é¢æ¿é€£çºŒèª¿æ•´æ™‚é¿å…é«˜é »é‡ç¹ª
      const CHART_DEBOUNCE_MS = 100;
      let chartUpdateTimer = null;

      function updateChart() {
        if (!currentRegressionData) return;
        if (chartUpdateTimer) {
          clearTimeout(chartUpdateTimer);
        }
        chartUpdateTimer = setTimeout(() => {
          drawRegressionChart();
        }, CHART_DEBOUNCE_MS);
      }
      
      // ä¸‹è¼‰åœ–è¡¨
      function downloadChart() {
        if (!regressionChartInstance) {
          alert('è«‹å…ˆç¹ªè£½åœ–è¡¨ï¼');
          return;
        }
        
        const canvas = document.getElementById('regressionCanvas');
        const backgroundType = document.getElementById('downloadBackground').value;
        
        if (backgroundType === 'white') {
          // å‰µå»ºä¸€å€‹æ–°çš„ canvas ä¸¦å¡«å……ç™½è‰²èƒŒæ™¯
          const tempCanvas = document.createElement('canvas');
          tempCanvas.width = canvas.width;
          tempCanvas.height = canvas.height;
          const tempCtx = tempCanvas.getContext('2d');
          
          // å¡«å……ç™½è‰²èƒŒæ™¯
          tempCtx.fillStyle = 'white';
          tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
          
          // å°‡åŸå§‹ canvas ç¹ªè£½åˆ°æ–° canvas ä¸Š
          tempCtx.drawImage(canvas, 0, 0);
          
          const url = tempCanvas.toDataURL('image/png');
          const link = document.createElement('a');
          link.download = 'ç·šæ€§å›æ­¸åˆ†æåœ–_ç™½åº•.png';
          link.href = url;
          link.click();
        } else {
          // é€æ˜èƒŒæ™¯
          const url = canvas.toDataURL('image/png');
          const link = document.createElement('a');
          link.download = 'ç·šæ€§å›æ­¸åˆ†æåœ–_é€æ˜.png';
          link.href = url;
          link.click();
        }
      }
      
      // æ›´æ–°ä¸ç¢ºå®šåº¦å‚³éè¼¸å…¥æ¬„ä½
      function updatePropagationInputs() {
        const type = document.getElementById('propagationType').value;
        let html = '';
        
        if (type === 'power') {
          html = `
            <div class="input-group">
              <label>A å€¼ï¼š</label>
              <input type="number" id="propA" step="any">
            </div>
            <div class="input-group">
              <label>A çš„ä¸ç¢ºå®šåº¦ (Î”A)ï¼š</label>
              <input type="number" id="propDeltaA" step="any">
            </div>
            <div class="input-group">
              <label>å†ªæ¬¡ (n)ï¼š</label>
              <input type="number" id="propN" step="any">
            </div>
          `;
        } else if (type !== 'custom') {
          html = `
            <div class="input-group">
              <label>A å€¼ï¼š</label>
              <input type="number" id="propA" step="any">
            </div>
            <div class="input-group">
              <label>A çš„ä¸ç¢ºå®šåº¦ (Î”A)ï¼š</label>
              <input type="number" id="propDeltaA" step="any">
            </div>
            <div class="input-group">
              <label>B å€¼ï¼š</label>
              <input type="number" id="propB" step="any">
            </div>
            <div class="input-group">
              <label>B çš„ä¸ç¢ºå®šåº¦ (Î”B)ï¼š</label>
              <input type="number" id="propDeltaB" step="any">
            </div>
          `;
        } else {
          html = `
            <p class="hint-text">è‡ªè¨‚å…¬å¼åŠŸèƒ½é–‹ç™¼ä¸­...</p>
          `;
        }
        
        document.getElementById('propagationInputs').innerHTML = html;
      }
      
      // ä¸ç¢ºå®šåº¦å‚³éè¨ˆç®—
      function calculatePropagation() {
        const type = document.getElementById('propagationType').value;
        let output = '';
        
        try {
          const A = parseFloat(document.getElementById('propA').value);
          const deltaA = parseFloat(document.getElementById('propDeltaA').value);
          
          if (type === 'add') {
            const B = parseFloat(document.getElementById('propB').value);
            const deltaB = parseFloat(document.getElementById('propDeltaB').value);
            const result = A + B;
            const deltaResult = Math.sqrt(deltaA * deltaA + deltaB * deltaB);
            
            output = `
              <div class="result-item"><strong>é‹ç®—é¡å‹ï¼š</strong>åŠ æ³•/æ¸›æ³•</div>
              <div class="result-item"><strong>çµæœå€¼ï¼š</strong>${result.toFixed(4)}</div>
              <div class="result-item"><strong>ä¸ç¢ºå®šåº¦ï¼š</strong>Â±${deltaResult.toFixed(4)}</div>
              <div class="result-item"><strong>å…¬å¼ï¼š</strong>Î”f = âˆš(Î”AÂ² + Î”BÂ²)</div>
              <div class="result-item"><strong>å®Œæ•´çµæœï¼š</strong>f = ${result.toFixed(4)} Â± ${deltaResult.toFixed(4)}</div>
            `;
          } else if (type === 'multiply') {
            const B = parseFloat(document.getElementById('propB').value);
            const deltaB = parseFloat(document.getElementById('propDeltaB').value);
            const result = A * B;
            const relativeUncertainty = Math.sqrt(
              Math.pow(deltaA/A, 2) + Math.pow(deltaB/B, 2)
            );
            const deltaResult = Math.abs(result) * relativeUncertainty;
            
            output = `
              <div class="result-item"><strong>é‹ç®—é¡å‹ï¼š</strong>ä¹˜æ³•/é™¤æ³•</div>
              <div class="result-item"><strong>çµæœå€¼ï¼š</strong>${result.toFixed(4)}</div>
              <div class="result-item"><strong>ä¸ç¢ºå®šåº¦ï¼š</strong>Â±${deltaResult.toFixed(4)}</div>
              <div class="result-item"><strong>ç›¸å°ä¸ç¢ºå®šåº¦ï¼š</strong>${(relativeUncertainty*100).toFixed(2)}%</div>
              <div class="result-item"><strong>å…¬å¼ï¼š</strong>Î”f/f = âˆš((Î”A/A)Â² + (Î”B/B)Â²)</div>
              <div class="result-item"><strong>å®Œæ•´çµæœï¼š</strong>f = ${result.toFixed(4)} Â± ${deltaResult.toFixed(4)}</div>
            `;
          } else if (type === 'power') {
            const n = parseFloat(document.getElementById('propN').value);
            const result = Math.pow(A, n);
            const deltaResult = Math.abs(n * Math.pow(A, n-1) * deltaA);
            
            output = `
              <div class="result-item"><strong>é‹ç®—é¡å‹ï¼š</strong>å†ªæ¬¡é‹ç®—</div>
              <div class="result-item"><strong>çµæœå€¼ï¼š</strong>${result.toFixed(4)}</div>
              <div class="result-item"><strong>ä¸ç¢ºå®šåº¦ï¼š</strong>Â±${deltaResult.toFixed(4)}</div>
              <div class="result-item"><strong>å…¬å¼ï¼š</strong>Î”f = |n Ã— A^(n-1) Ã— Î”A|</div>
              <div class="result-item"><strong>å®Œæ•´çµæœï¼š</strong>f = ${result.toFixed(4)} Â± ${deltaResult.toFixed(4)}</div>
            `;
          }
          
          document.getElementById('propagationOutput').innerHTML = output;
          document.getElementById('propagationResult').style.display = 'block';
        } catch (error) {
          alert('è«‹å¡«å¯«æ‰€æœ‰å¿…è¦æ¬„ä½ï¼');
        }
      }
      
      // äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹å¼æ±‚è§£
      function solveEquations() {
        try {
          const a1 = parseFloat(document.getElementById('eqA1').value);
          const b1 = parseFloat(document.getElementById('eqB1').value);
          const c1 = parseFloat(document.getElementById('eqC1').value);
          const a2 = parseFloat(document.getElementById('eqA2').value);
          const b2 = parseFloat(document.getElementById('eqB2').value);
          const c2 = parseFloat(document.getElementById('eqC2').value);
          
          // ä½¿ç”¨ Cramer's Rule
          const determinant = a1 * b2 - a2 * b1;
          
          if (Math.abs(determinant) < 1e-10) {
            alert('æ­¤æ–¹ç¨‹çµ„ç„¡å”¯ä¸€è§£ï¼ˆè¡Œåˆ—å¼ç‚ºé›¶ï¼‰ï¼');
            return;
          }
          
          const x = (c1 * b2 - c2 * b1) / determinant;
          const y = (a1 * c2 - a2 * c1) / determinant;
          
          // é©—è­‰
          const check1 = a1 * x + b1 * y;
          const check2 = a2 * x + b2 * y;
          
          const output = `
            <div class="result-item"><strong>æ–¹ç¨‹çµ„ï¼š</strong></div>
            <div class="result-item">  ${a1}x + ${b1}y = ${c1}</div>
            <div class="result-item">  ${a2}x + ${b2}y = ${c2}</div>
            <div class="result-item" style="margin-top: 15px;"><strong>è§£ï¼š</strong></div>
            <div class="result-item"><strong>x = </strong>${x.toFixed(6)}</div>
            <div class="result-item"><strong>y = </strong>${y.toFixed(6)}</div>
            <div class="result-item" style="margin-top: 15px;"><strong>é©—è­‰ï¼š</strong></div>
            <div class="result-item">ä»£å…¥ç¬¬ä¸€å¼ï¼š${check1.toFixed(6)} â‰ˆ ${c1}</div>
            <div class="result-item">ä»£å…¥ç¬¬äºŒå¼ï¼š${check2.toFixed(6)} â‰ˆ ${c2}</div>
          `;
          
          document.getElementById('equationOutput').innerHTML = output;
          document.getElementById('equationResult').style.display = 'block';
        } catch (error) {
          alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼');
        }
      }

    </script>
  </body>
</html>
