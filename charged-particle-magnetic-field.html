<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <title>å¸¶é›»ç²’å­åœ¨ç£å ´ä¸­çš„é‹å‹• - ç‰©ç†æ¨¡æ“¬</title>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="images/fish.png" rel="shortcut icon">
    
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/normalize.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: #f5f5f5;
        }
        
        .simulation-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .simulation-title {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #818181;
        }
        
        .canvas-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            background: #000;
            border-radius: 5px;
            padding: 10px;
        }
        
        #simulationCanvas {
            border: 2px solid #818181;
            background: #000;
            cursor: crosshair;
        }
        
        .controls-panel {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .control-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .control-group label {
            min-width: 180px;
            font-weight: 500;
            color: #555;
        }
        
        .control-group input[type="range"] {
            flex: 1;
            max-width: 300px;
        }
        
        .control-group input[type="number"] {
            width: 100px;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        
        .control-group .value-display {
            min-width: 80px;
            text-align: right;
            font-weight: bold;
            color: #818181;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .btn-sim {
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-start {
            background: #4CAF50;
            color: white;
        }
        
        .btn-start:hover {
            background: #45a049;
        }
        
        .btn-pause {
            background: #ff9800;
            color: white;
        }
        
        .btn-pause:hover {
            background: #e68900;
        }
        
        .btn-reset {
            background: #f44336;
            color: white;
        }
        
        .btn-reset:hover {
            background: #da190b;
        }
        
        .btn-back {
            background: #818181;
            color: white;
        }
        
        .btn-back:hover {
            background: #2f2f2f;
        }
        
        .info-panel {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }
        
        .info-panel h4 {
            margin-top: 0;
            color: #1976D2;
        }
        
        .info-panel p {
            margin: 5px 0;
            color: #555;
        }
        
        .formula {
            background: #fff;
            padding: 10px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="simulation-container">
        <h1 class="simulation-title">å¸¶é›»ç²’å­åœ¨ç£å ´ä¸­çš„é‹å‹•æ¨¡æ“¬</h1>
        
        <div class="info-panel">
            <h4>ğŸ“š ç‰©ç†åŸç†</h4>
            <p><strong>å‹å€«èŒ²åŠ›ï¼š</strong>ç•¶å¸¶é›»ç²’å­ä»¥é€Ÿåº¦ v é€²å…¥ç£å ´ B æ™‚ï¼Œæœƒå—åˆ°å‚ç›´æ–¼é€Ÿåº¦å’Œç£å ´çš„å‹å€«èŒ²åŠ›ã€‚</p>
            <div class="formula">F = q(v Ã— B) = qvB sin(Î¸)</div>
            <p><strong>åœ“å‘¨é‹å‹•ï¼š</strong>ç•¶ v âŠ¥ B æ™‚ï¼Œç²’å­åšç­‰é€Ÿç‡åœ“å‘¨é‹å‹•ï¼ŒåŠå¾‘ r = mv/(qB)</p>
            <p><strong>èºæ—‹é‹å‹•ï¼š</strong>ç•¶ v èˆ‡ B æœ‰å¤¾è§’æ™‚ï¼Œç²’å­åšèºæ—‹é‹å‹•</p>
        </div>
        
        <div class="canvas-container">
            <canvas id="simulationCanvas" width="2400" height="1800" style="width: 1200px; height: 900px;"></canvas>
        </div>
        
        <div class="button-group">
            <button class="btn-sim btn-start" onclick="startSimulation()">â–¶ é–‹å§‹</button>
            <button class="btn-sim btn-pause" onclick="pauseSimulation()">â¸ æš«åœ</button>
            <button class="btn-sim btn-reset" onclick="resetSimulation()">ğŸ”„ é‡ç½®</button>
            <button class="btn-sim btn-back" onclick="window.location.href='physics-simulations.html'">â† è¿”å›</button>
        </div>
        
        <div class="controls-panel">
            <h3 style="margin-top: 0; color: #333;">åƒæ•¸æ§åˆ¶</h3>
            
            <div class="control-group">
                <label>ç£å ´å¼·åº¦ B (T):</label>
                <input type="range" id="magneticField" min="0.1" max="5" step="0.1" value="1" oninput="updateMagneticField()">
                <span class="value-display" id="bValue">1.0 T</span>
            </div>
            
            <div class="control-group">
                <label>ç£å ´æ–¹å‘:</label>
                <select id="magneticDirection" onchange="updateMagneticDirection()" style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 3px;">
                    <option value="out">âŠ™ æŒ‡å‘è¢å¹•å¤–</option>
                    <option value="in">âŠ— æŒ‡å‘è¢å¹•å…§</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>ç²’å­é›»è· q (Ã—10â»Â¹â¹ C):</label>
                <input type="range" id="charge" min="-5" max="5" step="0.5" value="1.6" oninput="updateCharge()">
                <span class="value-display" id="qValue">1.6</span>
            </div>
            
            <div class="control-group">
                <label>ç²’å­è³ªé‡ m (Ã—10â»Â²â· kg):</label>
                <input type="range" id="mass" min="0.5" max="10" step="0.5" value="1.67" oninput="updateMass()">
                <span class="value-display" id="mValue">1.67</span>
            </div>
            
            <div class="control-group">
                <label>åˆé€Ÿåº¦ v (Ã—10â¶ m/s):</label>
                <input type="range" id="velocity" min="0.5" max="10" step="0.5" value="5" oninput="updateVelocity()">
                <span class="value-display" id="vValue">5.0</span>
            </div>
            
            <div class="control-group">
                <label>é€Ÿåº¦æ–¹å‘è§’åº¦ (åº¦):</label>
                <input type="range" id="angle" min="0" max="180" step="5" value="90" oninput="updateAngle()">
                <span class="value-display" id="angleValue">90Â°</span>
            </div>
            
            <div class="control-group">
                <label>åˆå§‹ä½ç½®:</label>
                <select id="initialPosition" onchange="updateInitialPosition()" style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 3px;">
                    <option value="right">å³å´</option>
                    <option value="left">å·¦å´</option>
                    <option value="top">ä¸Šæ–¹</option>
                    <option value="bottom">ä¸‹æ–¹</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>æ’­æ”¾é€Ÿåº¦:</label>
                <input type="range" id="playbackSpeed" min="0.1" max="5" step="0.1" value="1" oninput="updatePlaybackSpeed()">
                <span class="value-display" id="speedValue">1.0x</span>
            </div>
            
            <div class="control-group">
                <label>é¡¯ç¤ºè»Œè·¡:</label>
                <input type="checkbox" id="showTrail" checked onchange="toggleTrail()">
            </div>
        </div>
        
        <div class="controls-panel" style="background: #e8f5e9; border-left: 4px solid #4caf50;">
            <h4 style="margin-top: 0; color: #2e7d32;">ğŸ“Š å³æ™‚æ•¸æ“š</h4>
            <div class="control-group">
                <label>ç•¶å‰é€Ÿåº¦:</label>
                <span class="value-display" id="currentSpeed" style="color: #2e7d32; font-size: 16px;">0.000 Ã— 10â¶ m/s</span>
            </div>
            <div class="control-group">
                <label>ç†è«–åŠå¾‘ r = mv/(qB):</label>
                <span class="value-display" id="currentRadius" style="color: #2e7d32; font-size: 16px;">0.000 m</span>
            </div>
            <div class="control-group">
                <label>ç²’å­é›»è·:</label>
                <span class="value-display" id="currentCharge" style="color: #2e7d32; font-size: 16px;">+1.6 Ã— 10â»Â¹â¹ C</span>
            </div>
            <div class="control-group">
                <label>å‘é‡åœ–ä¾‹:</label>
                <span style="color: #ffd700; font-weight: bold;">â”â”â–º é€Ÿåº¦ v</span>
                <span style="color: #fff; background: #333; padding: 2px 8px; margin-left: 15px; border-radius: 3px; font-weight: bold;">â”â”â–º å‘å¿ƒåŠ› F = q(v Ã— B)</span>
            </div>
        </div>
        
        <div class="info-panel" style="background: #fff3cd; border-left-color: #ffc107;">
            <h4>ğŸ¯ ä½¿ç”¨èªªæ˜</h4>
            <p>â€¢ èª¿æ•´åƒæ•¸å¾ŒæŒ‰ã€Œé–‹å§‹ã€è§€å¯Ÿç²’å­é‹å‹•è»Œè·¡</p>
            <p>â€¢ æ­£é›»è·ï¼ˆç´…è‰²ï¼‰å’Œè² é›»è·ï¼ˆè—è‰²ï¼‰æœƒä»¥ç›¸åæ–¹å‘åè½‰</p>
            <p>â€¢ é€Ÿåº¦æ–¹å‘è§’åº¦ 90Â° ç‚ºå‚ç›´ç£å ´ï¼Œæœƒåšåœ“å‘¨é‹å‹•</p>
        </div>
    </div>
    
    <script>
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        
        let animationId = null;
        let isRunning = false;
        let showTrail = true;
        let playbackSpeed = 1.0;  // æ’­æ”¾é€Ÿåº¦å€ç‡
        
        // ç‰©ç†åƒæ•¸
        let B = 1.0;           // ç£å ´å¼·åº¦ (T)
        let magneticDirection = 'out'; // ç£å ´æ–¹å‘ï¼š'out' æŒ‡å‘è¢å¹•å¤–ï¼Œ'in' æŒ‡å‘è¢å¹•å…§
        let q = 1.6;           // é›»è· (Ã—10^-19 C)
        let m = 1.67;          // è³ªé‡ (Ã—10^-27 kg)
        let v = 5.0;           // é€Ÿåº¦ (Ã—10^6 m/s)
        let angle = 90;        // é€Ÿåº¦èˆ‡æ°´å¹³æ–¹å‘çš„è§’åº¦ï¼ˆåº¦ï¼‰
        let initialPosition = 'right'; // åˆå§‹ä½ç½®ï¼š'left', 'top', 'right', 'bottom'
        
        // ç²’å­ç‹€æ…‹
        let particle = {
            x: 2100,
            y: 900,
            vx: 0,
            vy: 0,
            trail: []
        };
        
        // ç¸®æ”¾å› å­ï¼ˆç”¨æ–¼å¯è¦–åŒ–ï¼‰
        const scale = 50;
        
        function updateMagneticField() {
            B = parseFloat(document.getElementById('magneticField').value);
            document.getElementById('bValue').textContent = B.toFixed(1) + ' T';
            // å¦‚æœæœªé‹è¡Œï¼Œå³æ™‚æ›´æ–°é¡¯ç¤ºï¼ˆå‘å¿ƒåŠ›å¤§å°æœƒè®Šï¼‰
            if (!isRunning) {
                redrawStatic();
            }
        }
        
        function updateMagneticDirection() {
            magneticDirection = document.getElementById('magneticDirection').value;
            // å¦‚æœæœªé‹è¡Œï¼Œå³æ™‚æ›´æ–°é¡¯ç¤ºï¼ˆç£å ´ç¬¦è™Ÿå’Œå‘å¿ƒåŠ›æ–¹å‘æœƒè®Šï¼‰
            if (!isRunning) {
                redrawStatic();
            }
        }
        
        function updateCharge() {
            q = parseFloat(document.getElementById('charge').value);
            document.getElementById('qValue').textContent = q.toFixed(1);
            // å¦‚æœæœªé‹è¡Œï¼Œå³æ™‚æ›´æ–°é¡¯ç¤ºï¼ˆå‘å¿ƒåŠ›å¤§å°å’Œæ–¹å‘æœƒè®Šï¼‰
            if (!isRunning) {
                redrawStatic();
            }
        }
        
        function updateMass() {
            m = parseFloat(document.getElementById('mass').value);
            document.getElementById('mValue').textContent = m.toFixed(2);
        }
        
        function updateVelocity() {
            v = parseFloat(document.getElementById('velocity').value);
            document.getElementById('vValue').textContent = v.toFixed(1);
            // å¦‚æœæœªé‹è¡Œï¼Œå³æ™‚æ›´æ–°é¡¯ç¤º
            if (!isRunning) {
                const angleRad = (angle * Math.PI) / 180;
                particle.vx = v * Math.cos(angleRad);
                particle.vy = -v * Math.sin(angleRad);
                redrawStatic();
            }
        }
        
        function updateAngle() {
            angle = parseFloat(document.getElementById('angle').value);
            document.getElementById('angleValue').textContent = angle.toFixed(0) + 'Â°';
            // å¦‚æœæœªé‹è¡Œï¼Œå³æ™‚æ›´æ–°é¡¯ç¤º
            if (!isRunning) {
                const angleRad = (angle * Math.PI) / 180;
                particle.vx = v * Math.cos(angleRad);
                particle.vy = -v * Math.sin(angleRad);
                redrawStatic();
            }
        }
        
        function toggleTrail() {
            showTrail = document.getElementById('showTrail').checked;
        }
        
        function updatePlaybackSpeed() {
            playbackSpeed = parseFloat(document.getElementById('playbackSpeed').value);
            document.getElementById('speedValue').textContent = playbackSpeed.toFixed(1) + 'x';
        }
        
        function updateInitialPosition() {
            initialPosition = document.getElementById('initialPosition').value;
            // å¦‚æœæœªé‹è¡Œï¼Œé‡ç½®ç²’å­ä½ç½®
            if (!isRunning) {
                const pos = getInitialCoordinates();
                particle.x = pos.x;
                particle.y = pos.y;
                const angleRad = (angle * Math.PI) / 180;
                particle.vx = v * Math.cos(angleRad);
                particle.vy = -v * Math.sin(angleRad);
                particle.trail = [];
                redrawStatic();
            }
        }
        
        function getInitialCoordinates() {
            // æ ¹æ“šé¸æ“‡è¿”å›åˆå§‹åº§æ¨™
            switch(initialPosition) {
                case 'left':
                    return { x: 300, y: 900 };  // å·¦å´ä¸­é–“
                case 'top':
                    return { x: 1200, y: 300 }; // ä¸Šæ–¹ä¸­é–“
                case 'right':
                    return { x: 2100, y: 900 }; // å³å´ä¸­é–“
                case 'bottom':
                    return { x: 1200, y: 1500 }; // ä¸‹æ–¹ä¸­é–“
                default:
                    return { x: 2100, y: 900 };
            }
        }
        
        function redrawStatic() {
            // éœæ…‹é‡ç¹ªï¼ˆæœªé‹è¡Œæ™‚çš„åƒæ•¸èª¿æ•´ï¼‰
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            drawGrid();
            drawParticle();
            updateInfoDisplay();
        }
        
        function resetSimulation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            isRunning = false;
            
            // é‡ç½®ç²’å­ä½ç½®å’Œé€Ÿåº¦ï¼ˆæ ¹æ“šé¸æ“‡çš„åˆå§‹ä½ç½®ï¼‰
            const pos = getInitialCoordinates();
            particle.x = pos.x;
            particle.y = pos.y;
            
            const angleRad = (angle * Math.PI) / 180;
            particle.vx = v * Math.cos(angleRad);
            particle.vy = -v * Math.sin(angleRad);
            particle.trail = [];
            
            // æ¸…ç©ºç•«å¸ƒ
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            drawGrid();
            drawParticle();
            updateInfoDisplay();
        }
        
        function startSimulation() {
            if (isRunning) return;
            isRunning = true;
            
            // åˆå§‹åŒ–é€Ÿåº¦
            const angleRad = (angle * Math.PI) / 180;
            particle.vx = v * Math.cos(angleRad);
            particle.vy = -v * Math.sin(angleRad);
            
            animate();
        }
        
        function pauseSimulation() {
            isRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }
        
        function animate() {
            if (!isRunning) return;
            
            // æ™‚é–“æ­¥é•·ï¼ˆè€ƒæ…®æ’­æ”¾é€Ÿåº¦ï¼‰
            const dt = 0.01 * playbackSpeed;
            
            // ç£å ´å‘é‡ B = (0, 0, Bz)
            // æŒ‡å‘è¢å¹•å¤–ï¼šBz > 0ï¼›æŒ‡å‘è¢å¹•å…§ï¼šBz < 0
            const Bz = magneticDirection === 'out' ? B : -B;
            
            // é€Ÿåº¦å‘é‡ v = (vx, vy, 0)
            const vx = particle.vx;
            const vy = particle.vy;
            const vz = 0;
            
            // è¨ˆç®—å‹å€«èŒ²åŠ›ï¼šF = q(v Ã— B)
            // v Ã— B = (vy*Bz - vz*By, vz*Bx - vx*Bz, vx*By - vy*Bx)
            // å› ç‚º B = (0, 0, Bz)ï¼Œæ‰€ä»¥ï¼š
            // v Ã— B = (vy*Bz, -vx*Bz, 0)
            const crossX = vy * Bz;
            const crossY = -vx * Bz;
            
            // åŠ é€Ÿåº¦ a = F/m = q(v Ã— B)/m
            const ax = (q * crossX) / m;
            const ay = (q * crossY) / m;
            
            // è¨˜éŒ„ç•¶å‰é€Ÿç‡ï¼ˆç£åŠ›ä¸åšåŠŸï¼Œé€Ÿç‡æ‡‰ä¿æŒæ†å®šï¼‰
            const currentSpeed = Math.sqrt(particle.vx * particle.vx + particle.vy * particle.vy);
            
            // æ›´æ–°é€Ÿåº¦ï¼šv(t+dt) = v(t) + a*dt
            particle.vx += ax * dt;
            particle.vy += ay * dt;
            
            // ä¿®æ­£é€Ÿåº¦å¤§å°ä»¥é¿å…æ•¸å€¼èª¤å·®ç´¯ç©ï¼ˆèƒ½é‡å®ˆæ†ï¼‰
            const newSpeed = Math.sqrt(particle.vx * particle.vx + particle.vy * particle.vy);
            if (newSpeed > 0) {
                const speedRatio = currentSpeed / newSpeed;
                particle.vx *= speedRatio;
                particle.vy *= speedRatio;
            }
            
            // æ›´æ–°ä½ç½®ï¼šr(t+dt) = r(t) + v*dt
            particle.x += particle.vx * scale * dt;
            particle.y += particle.vy * scale * dt;
            
            // é‚Šç•Œæª¢æ¸¬ï¼ˆå¾ªç’°é‚Šç•Œï¼‰
            if (particle.x < 0) particle.x = canvas.width;
            if (particle.x > canvas.width) particle.x = 0;
            if (particle.y < 0) particle.y = canvas.height;
            if (particle.y > canvas.height) particle.y = 0;
            
            // è¨˜éŒ„è»Œè·¡
            if (showTrail) {
                particle.trail.push({ x: particle.x, y: particle.y });
                if (particle.trail.length > 500) {
                    particle.trail.shift();
                }
            } else {
                particle.trail = [];
            }
            
            // ç¹ªè£½
            draw();
            
            // ä½¿ç”¨ requestAnimationFrame ç¹¼çºŒå‹•ç•«
            animationId = requestAnimationFrame(animate);
        }
        
        function draw() {
            // å®Œå…¨æ¸…ç©ºç•«å¸ƒï¼Œé¿å…æ®˜å½±
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            drawGrid();
            drawTrail();
            drawParticle();
            updateInfoDisplay();
        }
        
        function drawGrid() {
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 2;
            
            // ç¹ªè£½ç¶²æ ¼
            for (let x = 0; x < canvas.width; x += 150) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y < canvas.height; y += 150) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // ç¹ªè£½ç£å ´ç¬¦è™Ÿï¼šâŠ™ (æŒ‡å‘è¢å¹•å¤–) æˆ– âŠ— (æŒ‡å‘è¢å¹•å…§)
            ctx.fillStyle = '#444';
            ctx.font = '60px Arial';
            const magneticSymbol = magneticDirection === 'out' ? 'âŠ™' : 'âŠ—';
            for (let x = 150; x < canvas.width; x += 300) {
                for (let y = 150; y < canvas.height; y += 300) {
                    ctx.fillText(magneticSymbol, x - 24, y + 24);
                }
            }
        }
        
        function drawTrail() {
            if (particle.trail.length > 0) {
                // ä½¿ç”¨åŠé€æ˜çƒé«”ç¹ªè£½è»Œè·¡
                const baseColor = q > 0 ? '255, 100, 100' : '100, 150, 255';
                
                for (let i = 0; i < particle.trail.length; i++) {
                    // è¶ŠèˆŠçš„è»Œè·¡è¶Šé€æ˜ï¼ˆæé«˜ä¸é€æ˜åº¦ï¼‰
                    const alpha = 0.4 * (i / particle.trail.length);
                    ctx.fillStyle = `rgba(${baseColor}, ${alpha})`;
                    
                    // ç¹ªè£½æ¨¡ç³Šæ•ˆæœçš„çƒé«”ï¼ˆå¤šå±¤ç–ŠåŠ ï¼Œæé«˜äº®åº¦ï¼‰
                    for (let r = 12; r > 0; r -= 2) {
                        ctx.globalAlpha = 0.6 / r;
                        ctx.beginPath();
                        ctx.arc(particle.trail[i].x, particle.trail[i].y, r, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    ctx.globalAlpha = 1.0;
                }
            }
        }
        
        function drawParticle() {
            // ç¹ªè£½ç²’å­ï¼ˆé›™å€å¤§å°ï¼‰
            ctx.fillStyle = q > 0 ? '#ff3333' : '#3399ff';
            ctx.beginPath();
            ctx.arc(particle.x, particle.y, 16, 0, Math.PI * 2);
            ctx.fill();
            
            const vMag = Math.sqrt(particle.vx * particle.vx + particle.vy * particle.vy);
            if (vMag > 0) {
                // ç¹ªè£½é€Ÿåº¦å‘é‡ï¼ˆé»ƒè‰²ç²—é«”ï¼‰ï¼Œé•·åº¦èˆ‡é€Ÿåº¦æˆæ­£æ¯”
                const vArrowLength = 30 + vMag * 15; // åŸºç¤é•·åº¦30 + é€Ÿåº¦æ¯”ä¾‹
                const vxNorm = (particle.vx / vMag) * vArrowLength;
                const vyNorm = (particle.vy / vMag) * vArrowLength;
                
                ctx.strokeStyle = '#ffff00';
                ctx.lineWidth = 8;  // ç²—é«”åŠ å€
                ctx.beginPath();
                ctx.moveTo(particle.x, particle.y);
                ctx.lineTo(particle.x + vxNorm, particle.y + vyNorm);
                ctx.stroke();
                
                // é€Ÿåº¦ç®­é ­ï¼ˆå¤§å°èˆ‡ç®­é ­é•·åº¦æˆæ¯”ä¾‹ï¼‰
                const vAngle = Math.atan2(vyNorm, vxNorm);
                const arrowHeadSize = Math.min(24, vArrowLength * 0.3);
                ctx.lineWidth = 8;
                ctx.beginPath();
                ctx.moveTo(particle.x + vxNorm, particle.y + vyNorm);
                ctx.lineTo(
                    particle.x + vxNorm - arrowHeadSize * Math.cos(vAngle - Math.PI / 6),
                    particle.y + vyNorm - arrowHeadSize * Math.sin(vAngle - Math.PI / 6)
                );
                ctx.moveTo(particle.x + vxNorm, particle.y + vyNorm);
                ctx.lineTo(
                    particle.x + vxNorm - arrowHeadSize * Math.cos(vAngle + Math.PI / 6),
                    particle.y + vyNorm - arrowHeadSize * Math.sin(vAngle + Math.PI / 6)
                );
                ctx.stroke();
                
                // ç¹ªè£½å‘å¿ƒåŠ›å‘é‡ï¼ˆç™½è‰²ï¼‰
                // å‘å¿ƒåŠ› F = q(v Ã— B)
                // B = (0, 0, Bz)ï¼ŒæŒ‡å‘è¢å¹•å¤–Bz>0ï¼ŒæŒ‡å‘è¢å¹•å…§Bz<0
                // v Ã— B = (vy*Bz, -vx*Bz, 0)
                const Bz = magneticDirection === 'out' ? B : -B;
                const crossX = particle.vy * Bz;  // v Ã— B çš„ x åˆ†é‡
                const crossY = -particle.vx * Bz; // v Ã— B çš„ y åˆ†é‡
                
                // F = q(v Ã— B)
                const Fx = q * crossX;
                const Fy = q * crossY;
                
                // æ­¸ä¸€åŒ–ä¸¦è¨­å®šç®­é ­é•·åº¦ï¼ˆé•·åº¦èˆ‡åŠ›çš„å¤§å°æˆæ­£æ¯”ï¼‰
                const fMag = Math.sqrt(Fx * Fx + Fy * Fy);
                const fArrowLength = 25 + fMag * 10; // åŸºç¤é•·åº¦25 + åŠ›çš„æ¯”ä¾‹
                const fxNorm = fMag > 0 ? (Fx / fMag) * fArrowLength : 0;
                const fyNorm = fMag > 0 ? (Fy / fMag) * fArrowLength : 0;
                
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.moveTo(particle.x, particle.y);
                ctx.lineTo(particle.x + fxNorm, particle.y + fyNorm);
                ctx.stroke();
                
                // å‘å¿ƒåŠ›ç®­é ­ï¼ˆå¤§å°èˆ‡ç®­é ­é•·åº¦æˆæ¯”ä¾‹ï¼‰
                const fAngle = Math.atan2(fyNorm, fxNorm);
                const fArrowHeadSize = Math.min(20, fArrowLength * 0.3);
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.moveTo(particle.x + fxNorm, particle.y + fyNorm);
                ctx.lineTo(
                    particle.x + fxNorm - fArrowHeadSize * Math.cos(fAngle - Math.PI / 6),
                    particle.y + fyNorm - fArrowHeadSize * Math.sin(fAngle - Math.PI / 6)
                );
                ctx.moveTo(particle.x + fxNorm, particle.y + fyNorm);
                ctx.lineTo(
                    particle.x + fxNorm - fArrowHeadSize * Math.cos(fAngle + Math.PI / 6),
                    particle.y + fyNorm - fArrowHeadSize * Math.sin(fAngle + Math.PI / 6)
                );
                ctx.stroke();
            }
        }
        
        function updateInfoDisplay() {
            // æ›´æ–°HTMLé¢æ¿ä¸­çš„å³æ™‚è³‡è¨Š
            const speed = Math.sqrt(particle.vx * particle.vx + particle.vy * particle.vy);
            const radius = (m * speed) / (Math.abs(q) * B);
            
            document.getElementById('currentSpeed').textContent = speed.toFixed(3) + ' Ã— 10â¶ m/s';
            document.getElementById('currentRadius').textContent = radius.toFixed(3) + ' m';
            document.getElementById('currentCharge').textContent = (q > 0 ? '+' : '') + q.toFixed(1) + ' Ã— 10â»Â¹â¹ C';
        }
        
        // åˆå§‹åŒ–
        resetSimulation();
    </script>
</body>
</html>
